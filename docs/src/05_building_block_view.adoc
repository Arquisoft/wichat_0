ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]

== Building Block View

=== Whitebox Overall System (C4 Level 1)

==== Overview Diagram

Business context diagram

image::05_system_context_diagram.png[Overall view of the business context]

==== Motivation

The **Whitebox Overall System** diagram provides a high-level representation of the primary components and their interactions within the application, alongside the external systems it integrates with. This diagram is crucial for understanding the foundational architecture of the platform, showcasing the flow of data, system responsibilities, and external dependencies. It emphasizes the relationships between the various building blocks, such as the interaction between the user and the system, and how dynamic content is sourced via external APIs.

==== Contained Building Blocks

The key building blocks forming the overall system architecture include:

* **User**: Represents the end-user of the platform, who is required to authenticate in order to access the game functionality. Once authenticated, users can interact with the system and participate in gameplay.

* **Wichat EN2B Application**: The core application responsible for managing game mechanics, including the generation of questions and content. It encapsulates the application’s game logic and drives the user experience. Detailed breakdowns of its internal components are explored further in later sections.

* **WikiData API**: A third-party API providing structured knowledge, essential for the dynamic generation of trivia questions and content. The system queries the WikiData API for real-time data, which is used to populate game questions.

* **LLM API**: Another third-party API used for providing hints in response to user queries. It leverages large language models (such as GPT-based systems) to dynamically generate contextual content for enhancing user interactions. **Communication with the LLM occurs in a conversational manner**, where each request includes the entire conversation history (i.e., a list of all previous messages) to ensure context and continuity across interactions.

==== Important Interfaces

The **Important Interfaces** section defines the key interactions between system components and explains the methods through which the business requirements are met.

* **User to System Interaction**: Users engage with the system via a **web client** interface, which provides a rich UI experience with interactive elements such as forms, buttons, and dynamic feedback mechanisms. This client ensures a seamless user experience throughout the gameplay.

* **System to WikiData API Interaction**: The Wichat EN2B application interfaces with the **WikiData API** using a **question generator module**. This module sends HTTP requests containing **SPARQL queries** to retrieve structured knowledge from WikiData, which is subsequently processed and used to generate game questions.

* **System to LLM API Interaction**: The Wichat EN2B application communicates with the **LLM API** by passing the entire chat history of the logged-in user in each request. This ensures that the language model has full context of the ongoing conversation, enabling the generation of hints and responses that are contextually relevant and consistent with previous exchanges.

* **Internal Services Communication**: Internal services within the Wichat EN2B application communicate over **RESTful APIs**. For example, the **Gateway Service** routes incoming requests to the appropriate internal services, while the **Game Service** ensures game state management and flow control.

=== Container Diagram (C4 Level 2)

==== Container Diagram

image::05_container_diagram.png[Overall view of the business context]

==== Motivation

The **Container Diagram** offers a more granular view of the Wichat EN2B application’s architecture, illustrating how the application is organized into discrete containers (services) and the relationships between them. This diagram is instrumental in detailing the internal structure of the system and clarifying how the platform's various components work together to deliver its functionality.

It serves as an essential tool for understanding how user interactions are processed, how game logic is managed, and how both external and internal data sources are leveraged for seamless gameplay.

==== Contained Building Blocks

The following containers represent the primary services within the Wichat EN2B application, each with distinct responsibilities:

* **Web Application**: The front-end interface between the user and the system. This container is responsible for rendering the user interface (UI) and handling user interactions. Developed using **React**, the Web Application ensures a responsive and dynamic experience. It communicates with internal services via API calls.

* **Gateway Service**: Serves as the entry point for external API requests. This container is responsible for routing incoming requests to the correct internal services, ensuring that requests are handled efficiently and securely.

* **Game Service**: This service manages the core game logic, including the flow of the game, the presentation of questions, tracking of user progress, and determining the game's end. It also handles the game state, such as the user's score and question set.

* **LLM Service**: This container interfaces with a **Large Language Model (LLM)** to provide hints, explanations, and additional content to assist the user during the game. It ensures that users receive context-sensitive content, enhancing the overall gaming experience by offering real-time dynamic information. Communication with the LLM API is conducted conversationally by passing the entire message history in each request to maintain context and coherence.

* **MongoDB Database**: The database responsible for storing persistent system data, including user profiles, game states, and scores. MongoDB is used for its flexibility in handling semi-structured data and its scalability.

* **User Gateway**: A container dedicated to managing user-specific API requests. It handles user authentication, session management, and retrieval of user-related data, ensuring secure and personalized experiences.
