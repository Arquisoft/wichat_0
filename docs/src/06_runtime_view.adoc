ifndef::imagesdir[:imagesdir: ../images]

[[section-runtime-view]]
== Runtime View


ifdef::arc42help[]
[role="arc42help"]
****
.Contents
The runtime view describes concrete behavior and interactions of the systemâ€™s building blocks in form of scenarios from the following areas:

* important use cases or features: how do building blocks execute them?
* interactions at critical external interfaces: how do building blocks cooperate with users and neighboring systems?
* operation and administration: launch, start-up, stop
* error and exception scenarios

Remark: The main criterion for the choice of possible scenarios (sequences, workflows) is their *architectural relevance*. It is *not* important to describe a large number of scenarios. You should rather document a representative selection.

.Motivation
You should understand how (instances of) building blocks of your system perform their job and communicate at runtime.
You will mainly capture scenarios in your documentation to communicate your architecture to stakeholders that are less willing or able to read and understand the static models (building block view, deployment view).

.Form
There are many notations for describing scenarios, e.g.

* numbered list of steps (in natural language)
* activity diagrams or flow charts
* sequence diagrams
* BPMN or EPCs (event process chains)
* state machines
* ...


.Further Information

See https://docs.arc42.org/section-6/[Runtime View] in the arc42 documentation.

****
endif::arc42help[]

This section describes how the system components interacts between them. In this early stage, the information in this section cannot be too detailed.



=== User Authentication Flow

==== Sign up Flow

[plantuml,"Authentication Sign Up Sequence",png]
----
actor User
entity "Web Application" as App
entity "Authentication Service" as Auth
database "Users database" as Ust

User -> App: Sign up request
App -> Gat: Sends sign up data
Gat -> Auth: Forwards credentials
Auth -> Auth: Validate credentials
alt credentials are valid
    Auth -> Ust: Asks if user already exists
    Ust -> Ust: Searchs user
    alt user is not repeated
        Ust --> Auth: Non-repeated user
        Auth -> Ust: Sends new user's data to the database
        Ust -> Ust: Creates user
        Ust --> Auth: Success
        Auth --> Gat: Access token
        Gat --> App: Forwards acess token
        App --> User: Acess token
    else user is repeated
        Ust --> Auth: Error repeated user
        Auth --> Gat: Error repeated user
        Gat --> App: Forwards error repeated user
        App --> User: Log in page
    end
else credentials are invalid
    Auth --> Gat: Invalid credentials error
    Gat --> App: Forwards invalid credentials error
    App --> User: Error invalid credentials
end
----

Notable Aspects: Ensures secure signup via an authentication service. Protects against duplicated.

==== Log in Flow

[plantuml,"Authentication Log In Sequence",png]
----
actor User
entity "Web Application" as App
entity "Gateway Service" as Gat
entity "Authentication Service" as Auth
database "Users Database" as Ust

User -> App: Login request
App -> Gat: Sends login data
Gat -> Auth: Forwards credentials
Auth -> Auth: Validate credentials
alt credentials are valid
    Auth -> Ust: Search for registered users
    alt user is found and pasword is correct
        Ust --> Auth: Found user
        Auth --> Gat: Access token
        Gat --> App: Forwards acess token
        App --> User: Acess token
    else user is not found 
        Ust --> Auth: Not found user
        Auth --> Gat: Not found user
        Gat --> App: Forwards not found user
        App --> User: Sign up page
    else password is not correct
        Ust --> Auth: Error incorrect password
        Auth --> Gat: Error incorrect password
        Gat --> App: Forwards error incorrect password
        App --> User: Incorrect password
    end
else credentials are invalid
    Auth --> Gat: Error invalid credentials
    Gat --> App: Forwards error invalid credentials
end
----

Notable Aspects: Ensures secure authentication via an authentication service. Protects against unauthorized access and ensures session management.


=== Quiz Question Retrieval Flow

[plantuml,"Quiz Question Retrieval",png]
----
actor Admin
entity "Web Application" as App
entity "Gateway Service" as Gat
entity "Question Service" as Qus
boundary "Wikidata API" as Wiki
database "Questions Database" as Qdb

Admin -> App: Request generate batch of quiz questions
App -> Gat: Sends the request
Gat -> Qus: Forwards petition to the microservice
loop Until batch is full
    Qus -> Wiki: Fetch relevant question
    Wiki --> Qus: Answer
    alt If an error occurs
        Qus -> Qus: Discard recolected data
        break Exit loop
        Qus --> Gat: Error while fetching questions
        Gat --> App: Forwards error
        App --> Admin: Notify error
    else No error occurs
        Qus -> Qus: Store data
    end
end
Qus -> Qdb: Clear old data
Qdb -> Qdb: Clear old data
Qdb --> Qus: Old data removed
Qus -> Qdb: New data
Qdb -> Qdb: Store new data
Qdb --> Qus: New data stored
Qus --> Gat: New data generated
Gat --> App: Forwards message
App --> Admin: New questions were generated
----

Notable Aspects: Ensures an improvement in performance, reducing external api calls

=== LLM Chat Interaction Flow

[plantuml,"LLM Chat Interaction",png]
----
actor User
entity "Web Application" as App
entity "LLM Service" as LLM

User -> App: Send chat message
App -> LLM: Process user input
LLM --> App: Generate response
App --> User: Display chat reply
----

Notable Aspects: Secure input handling is necessary to prevent prompt injection. Ensuring low-latency responses enhances user experience.

=== Error Handling Scenario

[plantuml,"Error Handling Sequence",png]
----
actor User
entity "Web Application" as App
entity "Logging Service" as Log

User -> App: Perform action
App -> App: Error occurs
App -> Log: Log error details
App --> User: Display error message
----
Notable Aspects: Ensures errors are logged for troubleshooting and users receive meaningful error messages.
